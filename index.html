<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script src="libs/jquery.js"></script>
    <script src="libs/underscore.js"></script>
    <script src="libs/backbone.js"></script>
</head>
<body>
<div class="wrapper">
    Property Cross
    <div class="main_screen">
    </div>
</div>

<script type="text/template" id="main_screen">
    <h1>HELLLO</h1>
    <input type="text" id="place"/>
    <button id="search">Search</button>
    <button id="show">Show</button>
</script>
</body>
<script type="text/javascript">
    var City = Backbone.Model.extend();
    var SearchCities = Backbone.Collection.extend({
        url: 'http://api.nestoria.co.uk/api?country=uk&pretty=1&action=search_listings&encoding=json&listing_type=buy&page=1',
        model: City,
        parse: function(resp, xhr){
            return resp.response.listings;
        }
    });
    var z = new SearchCities();
    var MainScreen = Backbone.View.extend({
        el: '.main_screen',
        render: function(){
            var template = _.template($('#main_screen').html());
            this.$el.html(template)
        },
        events: {
            'click #search': 'search',
            'click #show': 'show'
        },
        initialize: function(){
            this.model = new SearchCities();
        },
        show: function(){
            console.log(this.model)
            console.log(localStorage.getItem('place'))
            console.log(localStorage.getItem('count'))
        },
        search: function(){
            var place = this.$el.find('#place').val();
            this.model.fetch({
                data: {place_name: place},
                success: function(col, resp){
                    console.log('==========================')
                    console.log(col)
                    console.log(resp)
                    localStorage.setItem('place', place)
                    localStorage.setItem('count', resp.response.total_results)
                }
            })
        }
    });
    var Router = Backbone.Router.extend({
        routes: {
            '' : 'home'
        }
    });
    var router = new Router();
    var mainScreen = new MainScreen();
    router.on('route:home', function(){
        mainScreen.render();
    });
    Backbone.history.start();
</script>
</html>